<script>

function parseYearMonth(dateStr) {
  // ä¾‹: "2025/06/18ï¼ˆæ°´ï¼‰1é™ ï½ 2025/06/19ï¼ˆæœ¨ï¼‰4é™"
  let m = dateStr.match(/^(\d{4})\/(\d{2})/);
  if (!m) return {year:"ä¸æ˜", month:"ä¸æ˜"};
  return {year: m[1], month: String(Number(m[2]))};
}

function renderStatus(entries) {
  // å¹´åº¦â†’æœˆã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  const grouped = {};
  entries.forEach(e => {
    const {year, month} = parseYearMonth(e.date || "");
    if (!grouped[year]) grouped[year] = {};
    if (!grouped[year][month]) grouped[year][month] = [];
    grouped[year][month].push(e);
  });

  const container = document.getElementById('accordionContainer');
  container.innerHTML = "";

  if (!entries || entries.length === 0) {
    container.innerHTML = "<p>è©²å½“ã™ã‚‹ç”³è«‹çŠ¶æ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
    return;
  }

  Object.keys(grouped).sort((a,b)=>b-a).forEach(year => {
    // å¹´åº¦ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³
    const yearDiv = document.createElement("div");
    yearDiv.className = "accordion-year";
    yearDiv.innerHTML = `<button class="accordion-toggle">${year}å¹´åº¦</button><div class="accordion-panel"></div>`;
    container.appendChild(yearDiv);

    const yearBtn = yearDiv.querySelector(".accordion-toggle");
    const yearPanel = yearDiv.querySelector(".accordion-panel");
    yearPanel.style.display = "none";

    yearBtn.onclick = () => {
      yearPanel.style.display = (yearPanel.style.display === "none") ? "block" : "none";
    };

    // æœˆã”ã¨ã®ãƒ‘ãƒãƒ«
    Object.keys(grouped[year]).sort((a,b)=>b-a).forEach(month => {
      const monthDiv = document.createElement("div");
      monthDiv.className = "accordion-month";
      monthDiv.style.marginLeft = "1em";
      monthDiv.innerHTML = `<button class="accordion-toggle">${month}æœˆ</button><div class="accordion-panel"></div>`;
      yearPanel.appendChild(monthDiv);

      const monthBtn = monthDiv.querySelector(".accordion-toggle");
      const monthPanel = monthDiv.querySelector(".accordion-panel");
      monthPanel.style.display = "none";

      monthBtn.onclick = () => {
        monthPanel.style.display = (monthPanel.style.display === "none") ? "block" : "none";
      };

      // ç”³è«‹ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
      grouped[year][month].forEach(entry => {
        const card = document.createElement("div");
        card.className = "entry-card";
        card.innerHTML = `
          <div>ğŸ“… <b>${entry.date}</b></div>
          <div>ç†ç”±ï¼š${entry.reason}</div>
         <div class="${
  entry.decision === 'è¨±å¯' ? 'status-approved' :
  entry.decision === 'å´ä¸‹' ? 'status-rejected' :
  'status-pending'
}">
  è£å®šï¼š${
    entry.decision === 'è¨±å¯' ? 'è¨±å¯' :
    entry.decision === 'å´ä¸‹' ? 'å´ä¸‹' + (entry.rejectReason ? 'ï¼ˆ' + entry.rejectReason + 'ï¼‰' : '') :
    entry.decision === 'æœªå‡¦ç†' ? 'å‡¦ç†ä¸­' :
    'å‡¦ç†ä¸­'  // ç©ºæ¬„ã‚„nullã§ã‚‚å‡¦ç†ä¸­
  }
</div>
        `;
        monthPanel.appendChild(card);
      });
    });
  });
}

</script>
